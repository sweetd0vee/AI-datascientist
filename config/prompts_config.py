"""
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è LLM
"""

# –ü—Ä–æ–º–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
STRUCT_ANALYZE_PROMPT = """
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ:
{file_info}
–û–ø—Ä–µ–¥–µ–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏—è —Å—Ç–æ–ª–±—Ü–æ–≤ –∏ –∏—Ö —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö (—á–∏—Å–ª–æ–≤–æ–π, –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–π, –¥–∞—Ç–∞, –±—É–ª–µ–≤—ã–π –∏ —Ç.–¥.).
–û—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ —É–¥–µ–ª–∏—Ç–µ —Å—Ç–æ–ª–±—Ü–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–∞—Ç—É/–≤—Ä–µ–º—è.

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å –∞–Ω–∞–ª–∏–∑ –≤ —Ñ–æ—Ä–º–∞—Ç–µ, —Å—Ç—Ä–æ–≥–æ —Å–ª–µ–¥—É—è —à–∞–±–ª–æ–Ω—É –Ω–∏–∂–µ. –ù–µ –¥–æ–±–∞–≤–ª—è–π –ø–æ—è—Å–Ω–µ–Ω–∏—è –∏–ª–∏ –¥—Ä—É–≥–æ–π —Ç–µ–∫—Å—Ç –¥–æ –∏–ª–∏ –ø–æ—Å–ª–µ:
---COLUMNS_START---
–°—Ç–æ–ª–±–µ—Ü: –∏–º—è_—Å—Ç–æ–ª–±—Ü–∞_1
–¢–∏–ø: –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã–π_—Ç–∏–ø_–¥–∞–Ω–Ω—ã—Ö
–û–ø–∏—Å–∞–Ω–∏–µ: –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è

–°—Ç–æ–ª–±–µ—Ü: –∏–º—è_—Å—Ç–æ–ª–±—Ü–∞_2
–¢–∏–ø: –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã–π_—Ç–∏–ø_–¥–∞–Ω–Ω—ã—Ö
–û–ø–∏—Å–∞–Ω–∏–µ: –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
---COLUMNS_END---
---DATETIME_CANDIDATES_START---
–∏–º—è_—Å—Ç–æ–ª–±—Ü–∞_1, –∏–º—è_—Å—Ç–æ–ª–±—Ü–∞_3
---DATETIME_CANDIDATES_END---

–ü—Ä–∏–º–µ—Ä (–Ω–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å):
---COLUMNS_START---
–°—Ç–æ–ª–±–µ—Ü: PassengerId
–¢–∏–ø: numerical (integer)
–û–ø–∏—Å–∞–Ω–∏–µ: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–∞—Å—Å–∞–∂–∏—Ä–∞

–°—Ç–æ–ª–±–µ—Ü: Name
–¢–∏–ø: textual (object)
–û–ø–∏—Å–∞–Ω–∏–µ: –ò–º—è –ø–∞—Å—Å–∞–∂–∏—Ä–∞
---COLUMNS_END---
---DATETIME_CANDIDATES_START---

---DATETIME_CANDIDATES_END---
"""

# –ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–ª–∞–Ω–∞ –º–µ—Ç—Ä–∏–∫
METRICS_PLAN_PROMPT = """
–ù–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:
{data_structure}
–ü—Ä–µ–¥–ª–æ–∂–∏ —Å–ø–∏—Å–æ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç—Ä–∏–∫, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–æ–∏—Ç —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö. –£—á—Ç–∏ Best Practices –ø–æ –∞–Ω–∞–ª–∏–∑—É –¥–∞–Ω–Ω—ã—Ö:

- –î–ª—è —á–∏—Å–ª–æ–≤—ã—Ö —Å—Ç–æ–ª–±—Ü–æ–≤:
    * –ú–µ—Ä—ã —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏: mean (—Å—Ä–µ–¥–Ω–µ–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–µ), median (–º–µ–¥–∏–∞–Ω–∞), mode (–Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞—é—â–µ–µ—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ)
    * –ú–µ—Ä—ã –∏–∑–º–µ–Ω—á–∏–≤–æ—Å—Ç–∏: std (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ), var (–¥–∏—Å–ø–µ—Ä—Å–∏—è), mad (—Å—Ä–µ–¥–Ω–µ–µ –∞–±—Å–æ–ª—é—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ)
    * –ú–µ—Ä—ã —Ñ–æ—Ä–º—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è: skew (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∞—Å–∏–º–º–µ—Ç—Ä–∏–∏), kurtosis (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —ç–∫—Å—Ü–µ—Å—Å–∞)
    * –ö–≤–∞–Ω—Ç–∏–ª–∏: min (–º–∏–Ω–∏–º—É–º), max (–º–∞–∫—Å–∏–º—É–º), quantile_25 (1-–π –∫–≤–∞—Ä—Ç–∏–ª—å, 25%), quantile_75 (3-–π –∫–≤–∞—Ä—Ç–∏–ª—å, 75%), quantile_90 (90-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å), quantile_95 (95-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å)
    * –î—Ä—É–≥–∏–µ: count (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π), iqr (–∏–Ω—Ç–µ—Ä–∫–≤–∞—Ä—Ç–∏–ª—å–Ω—ã–π —Ä–∞–∑–º–∞—Ö)

- –î–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö —Å—Ç–æ–ª–±—Ü–æ–≤:
    * count (–æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π)
    * nunique (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π)
    * mode (–Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ—Ç–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è)
    * mode_count (—á–∞—Å—Ç–æ—Ç–∞ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ) —Å–∞–º–æ–π —á–∞—Å—Ç–æ—Ç–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
    * mode_rel_freq (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞ (–¥–æ–ª—è) —Å–∞–º–æ–π —á–∞—Å—Ç–æ—Ç–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)

- –î–ª—è –¥–∞—Ç (datetime):
    * count (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π)
    * min_date (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è/—Ä–∞–Ω–Ω—è—è –¥–∞—Ç–∞)
    * max_date (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è/–ø–æ–∑–¥–Ω—è—è –¥–∞—Ç–∞)
    * date_range_days (–æ–±—â–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç –≤ –¥–Ω—è—Ö, —Ä–∞–∑–Ω–∏—Ü–∞ max_date - min_date –≤ –¥–Ω—è—Ö)
    * unique_dates (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –¥–∞—Ç/–¥–Ω–µ–π)
    * dates_per_month (—Å—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –Ω–∞ –º–µ—Å—è—Ü, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)

–í–µ—Ä–Ω–∏ —Å–ø–∏—Å–æ–∫ –º–µ—Ç—Ä–∏–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ, —Å—Ç—Ä–æ–≥–æ —Å–ª–µ–¥—É—è —à–∞–±–ª–æ–Ω—É –Ω–∏–∂–µ. –ù–µ –¥–æ–±–∞–≤–ª—è–π –ø–æ—è—Å–Ω–µ–Ω–∏—è –∏–ª–∏ –¥—Ä—É–≥–æ–π —Ç–µ–∫—Å—Ç –¥–æ –∏–ª–∏ –ø–æ—Å–ª–µ:
---METRICS_START---
–°—Ç–æ–ª–±–µ—Ü: —Å—Ç–æ–ª–±–µ—Ü_1
–ú–µ—Ç—Ä–∏–∫–∏: –º–µ—Ç—Ä–∏–∫–∞1, –º–µ—Ç—Ä–∏–∫–∞2, –º–µ—Ç—Ä–∏–∫–∞3

–°—Ç–æ–ª–±–µ—Ü: —Å—Ç–æ–ª–±–µ—Ü_2
–ú–µ—Ç—Ä–∏–∫–∏: –º–µ—Ç—Ä–∏–∫–∞4, –º–µ—Ç—Ä–∏–∫–∞5
---METRICS_END---

–ü—Ä–∏–º–µ—Ä (–Ω–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å):
---METRICS_START---
–°—Ç–æ–ª–±–µ—Ü: Age
–ú–µ—Ç—Ä–∏–∫–∏: count, mean, median, mode, std, var, min, max, quantile_25, quantile_75, skew, kurtosis, mad, iqr

–°—Ç–æ–ª–±–µ—Ü: Sex
–ú–µ—Ç—Ä–∏–∫–∏: count, nunique, mode, mode_count, mode_rel_freq

–°—Ç–æ–ª–±–µ—Ü: SignupDate
–ú–µ—Ç—Ä–∏–∫–∏: count, min_date, max_date, date_range_days, unique_dates
---METRICS_END---
"""

# –ü—Ä–æ–º–ø—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –º–µ—Ç—Ä–∏–∫
DATA_ANALYZE_PROMPT = """
–ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞:
{metrics_results_raw}

–¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –ø—Ä–æ–≤–µ—Å—Ç–∏ –≥–ª—É–±–æ–∫–∏–π –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —ç—Ç–∏—Ö –º–µ—Ç—Ä–∏–∫ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –ü–æ–¥—Ä–æ–±–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∫–∞–∂–¥—ã–π —Å—Ç–æ–ª–±–µ—Ü, —É—á–∏—Ç—ã–≤–∞—è –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏. –û–±—ã—á–Ω–æ –æ–±—ä–µ–º –æ—Ç—á–µ—Ç–∞ - 40-50 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.
"""

# –ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏—Ç–æ–≥–æ–≤–æ–≥–æ –æ—Ç—á–µ—Ç–∞
FINAL_REPORT_PROMPT = """
–ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫ –∫–∞–∂–¥–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞:
{analysis_summary}
—Å–æ—Å—Ç–∞–≤—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –ª–æ–≥–∏—á–µ—Å–∫–∏ –≤—ã—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∏ —Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏ –≤—ã–¥–µ—Ä–∂–∞–Ω–Ω—ã–π –æ—Ç—á—ë—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—Å–µ—Å—Ç–æ—Ä–æ–Ω–Ω–µ –æ—Ü–µ–Ω–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö, –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏ –∏ –∞–Ω–æ–º–∞–ª–∏–∏. –û—Ç—á—ë—Ç –¥–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å –æ–±—â—É—é —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö, –∞–Ω–∞–ª–∏–∑ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç–∏ –∏ –ø–æ–ª–Ω–æ—Ç—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ —Å—Ç–æ–ª–±—Ü–∞–º, –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º (–ø—Ä–æ–ø—É—Å–∫–∏, –≤—ã–±—Ä–æ—Å—ã, –¥—É–±–ª–∏–∫–∞—Ç—ã, –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã), –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞–±–ª—é–¥–∞–µ–º—ã—Ö –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–µ–π –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π, –∞ —Ç–∞–∫–∂–µ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è ‚Äî –≤ —Ç–æ–º —á–∏—Å–ª–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ –æ—á–∏—Å—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—é –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–≥–ª—É–±–ª–µ–Ω–∏—è. –¢–æ–Ω –∏–∑–ª–æ–∂–µ–Ω–∏—è ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, –Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–π, –ø–æ–¥–∞—á–∞ ‚Äî –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è, —Å –ø–ª–∞–≤–Ω—ã–º–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏ –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏.
"""

# –ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞ —Ä–∞—Å—á–µ—Ç–∞ –º–µ—Ç—Ä–∏–∫
METRICS_CODE_GEN_PROMPT = """
–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ Python –∏ –∞–Ω–∞–ª–∏–∑—É –¥–∞–Ω–Ω—ã—Ö. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞–ø–∏—Å–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π Python-–∫–æ–¥ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –∑–∞–¥–∞–Ω–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –ø–æ —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å—Ç–æ–ª–±—Ü–∞–º DataFrame —Å –≤—ã–≤–æ–¥–æ–º —á–µ—Ä–µ–∑ print(metrics_results).

–£ —Ç–µ–±—è –µ—Å—Ç—å DataFrame `df`, —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π –≤ —Å—Ä–µ–¥—É. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ df:
{df_structure_info}

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç–æ–ª–±—Ü–æ–≤:
{metrics_plan}

–°–ª–µ–¥—É–π —ç—Ç–∏–º –ø—Ä–∞–≤–∏–ª–∞–º:

- –≤—Å–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ—Å–º —É—Ä–æ–≤–Ω–µ
- –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ pandas, numpy. –ù–µ –¥–æ–±–∞–≤–ª—è–π —Å—Ç—Ä–æ–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ ‚Äî –æ–Ω–∏ —É–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã.
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–π –¢–û–õ–¨–ö–û —Ç–µ –º–µ—Ç—Ä–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —É–∫–∞–∑–∞–Ω—ã –≤ `{metrics_plan}` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞.
- –ü–†–ï–ñ–î–ï —á–µ–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ `df["–∏–º—è_—Å—Ç–æ–ª–±—Ü–∞"]`, –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–æ–≤–µ—Ä—è–π, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Å—Ç–æ–ª–±–µ—Ü –≤ `df.columns`. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø—Ä–æ–ø—É—Å—Ç–∏.
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞:
  - –°–æ–∑–¥–∞–π –∫–æ–ø–∏—é: `series = df[col].copy()`
  - –í—Å–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (NaN, NaT) –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –∫–∞–∫ `None` –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ. –ù–µ –æ—Å—Ç–∞–≤–ª—è–π `nan`, `nat` –∏–ª–∏ `np.nan`.
  #
- –î–ª—è –º–µ—Ç—Ä–∏–∫, —Ç—Ä–µ–±—É—é—â–∏—Ö resample (–Ω–∞–ø—Ä–∏–º–µ—Ä, dates_per_month, dates_per_year):
1. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π series.resample(...) –Ω–∞–ø—Ä—è–º—É—é, –µ—Å–ª–∏ series.index –Ω–µ —è–≤–ª—è–µ—Ç—Å—è DatetimeIndex.
2. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —Å–æ–∑–¥–∞–π –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å–µ—Ä–∏—é, –≥–¥–µ –∏–Ω–¥–µ–∫—Å - —ç—Ç–æ —Å–∞–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è datetime
#

- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤:
  - –í—Å–µ —Å–∫–∞–ª—è—Ä–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–µ—Ç—Ä–∏–∫) –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Ç–∏–ø–∞—Ö Python: `int`, `float`, `str`, `bool`, `None`.
  - –ò—Å–ø–æ–ª—å–∑—É–π: `int(x)` –¥–ª—è —Ü–µ–ª—ã—Ö, `float(x)` –¥–ª—è –≤–µ—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö, `str(x)` –¥–ª—è –¥–∞—Ç, `.tolist()` –¥–ª—è —Å–ø–∏—Å–∫–æ–≤.
  - –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî `NaN`, `NaT` –∏–ª–∏ `None`, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `None`.
  - –î–ª—è —á–∏—Å–ª–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫ (mean, std –∏ —Ç.–¥.) –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –∫–æ–ª–æ–Ω–∫–∏ —Å —Ç–∏–ø–æ–º `int64`, `float64`, –∏–ª–∏ —Ç–µ, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ —á–∏—Å–ª–æ–≤–æ–π —Ç–∏–ø —á–µ—Ä–µ–∑ `pd.to_numeric(series, errors='coerce')`. –ï—Å–ª–∏ –ø–æ—Å–ª–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è ‚Äî NaN, —Å—á–∏—Ç–∞–π –∫–æ–ª–æ–Ω–∫—É –Ω–µ—á–∏—Å–ª–æ–≤–æ–π.

- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤:
  - –ù–µ –∏–∑–º–µ–Ω—è–π –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
  - –í–º–µ—Å—Ç–æ `series.fillna(None)` –∏—Å–ø–æ–ª—å–∑—É–π: `series = series.where(pd.notna(series), None)` ‚Äî —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤.
  - –ò–ª–∏, –µ—Å–ª–∏ –º–µ—Ç—Ä–∏–∫–∞ —Ç—Ä–µ–±—É–µ—Ç —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, mean), –∏—Å–ø–æ–ª—å–∑—É–π `series.dropna()` **—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —ç—Ç–æ–π –º–µ—Ç—Ä–∏–∫–∏**, –Ω–µ –∏–∑–º–µ–Ω—è—è `series` –≥–ª–æ–±–∞–ª—å–Ω–æ.

- –î–ª—è datetime-–º–µ—Ç—Ä–∏–∫:
  - –£–±–µ–¥–∏—Å—å, —á—Ç–æ `series.dtype == 'datetime64[ns]'`.
  - –î–ª—è `dates_per_month`: —Å–æ–∑–¥–∞–π –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å–µ—Ä–∏—é: `temp = pd.Series(1, index=pd.to_datetime(series.dropna()))`, –∑–∞—Ç–µ–º `temp.resample('M').count().tolist()`.

- –ü—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ –∫–æ–¥–∞ —Å NumPy-–º–∞—Å—Å–∏–≤–∞–º–∏ –∏—Å–ø–æ–ª—å–∑—É–π —è–≤–Ω—ã–µ —É—Å–ª–æ–≤–∏—è: np.any(condition) –∏–ª–∏ np.all(condition) –≤–º–µ—Å—Ç–æ if condition:
- –î–ª—è `mad`: –∏—Å–ø–æ–ª—å–∑—É–π —Ñ–æ—Ä–º—É–ª—É: `mad_val = (series - series.mean()).abs().mean()`, –µ—Å–ª–∏ `series` —á–∏—Å–ª–æ–≤–∞—è.
- –ù–µ –∏–∑–º–µ–Ω—è–π `df`, –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–π –∏–Ω–¥–µ–∫—Å, –Ω–µ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–π —Ç–∏–ø –∏–Ω–¥–µ–∫—Å–∞.
- –ò–∑–±–µ–≥–∞–π –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ —Å—á–∏—Ç–∞–π `quantile(0.25)` –¥–≤–∞–∂–¥—ã).
- –ö–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–≤–æ–±–æ–¥–µ–Ω –æ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –∏ –≥–æ—Ç–æ–≤ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é.
- –í—ã–≤–µ–¥–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π: print(metrics_results)

–í–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ Python-–∫–æ–¥ –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏–π (–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º —É—Ä–æ–≤–Ω–µ), –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏–ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.
"""

# –ü—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
VISUALIZATION_CODE_PROMPT = """
# üéØ –¶–ï–õ–¨
–ü–æ—Å—Ç—Ä–æ–π –≥—Ä–∞—Ñ–∏–∫–∏, –∏–ª–ª—é—Å—Ç—Ä–∏—Ä—É—é—â–∏–µ –û–°–ù–û–í–ù–´–ï –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ –∏–∑ –∞–Ω–∞–ª–∏–∑–∞ –º–µ—Ç—Ä–∏–∫. –ö–∞–∂–¥—ã–π –≥—Ä–∞—Ñ–∏–∫ –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –£–ù–ò–ö–ê–õ–¨–ù–£–ô –∏–Ω—Å–∞–π—Ç. –ù–ï –î–£–ë–õ–ò–†–£–ô –ò–î–ï–ò.

# ‚ö†Ô∏è –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø
- –ü–æ—Å—Ç—Ä–æ–π —Ä–æ–≤–Ω–æ {num_plots} –≥—Ä–∞—Ñ–∏–∫–æ–≤, –Ω–µ –±–æ–ª—å—à–µ, –Ω–µ –º–µ–Ω—å—à–µ

# üìä –¢–ò–ü–´ –ì–†–ê–§–ò–ö–û–í (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —á–∏—Å–ª–æ–≤—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (hist, kde, box, violin)
- –°–≤—è–∑—å —á–∏—Å–ª–æ–≤–æ–π –∏ categor–∏–∞–ª—å–Ω–æ–π (boxplot/violinplot)
- –°–≤—è–∑—å –¥–≤—É—Ö —á–∏—Å–ª–æ–≤—ã—Ö (scatter —Å hue, regplot)
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ (barplot, countplot)
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã (–∞–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º)
- –í–∑–∞–∏–º–æ—Å–≤—è–∑–∏ (heatmap –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π, crosstab)
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–Ω—Å–∞–π—Ç—ã (–∞–Ω–æ–º–∞–ª–∏–∏, —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –≥—Ä—É–ø–ø)

# üé® –¶–í–ï–¢–û–í–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø
- –í—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ü–≤–µ—Ç–Ω—ã–º–∏.
- –í barplot –∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞—Ö –ö–ê–ñ–î–´–ô —Å—Ç–æ–ª–±–µ—Ü –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Å–≤–æ–π —Ü–≤–µ—Ç (–∏—Å–ø–æ–ª—å–∑—É–π palette, hue, –∏–ª–∏ color –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞)
- –ò—Å–ø–æ–ª—å–∑—É–π –ø–∞–ª–∏—Ç—Ä—ã: `palette='tab10'`, `cmap='viridis'`, `color=...`, `hue=...`.
- –ü—Ä–∏–º–µ–Ω—è–π `hue`, `palette`, `cmap` –≤–µ–∑–¥–µ, –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ.
- –ù–µ –æ—Å—Ç–∞–≤–ª—è–π –≥—Ä–∞—Ñ–∏–∫–∏ —á–µ—Ä–Ω–æ-–±–µ–ª—ã–º–∏ –∏–ª–∏ –æ–¥–Ω–æ—Ç–æ–Ω–Ω—ã–º–∏.
- –í barplot –∏—Å–ø–æ–ª—å–∑—É–π `palette` –∏–ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞–π —Å–ø–∏—Å–æ–∫ —Ü–≤–µ—Ç–æ–≤, —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π —Å—Ç–æ–ª–±–µ—Ü –±—ã–ª —Ä–∞–∑–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞.

# üö´ –ó–ê–ü–†–ï–©–ï–ù–û
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–¥–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ –±–µ–∑ –Ω–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏)
- –ì—Ä–∞—Ñ–∏–∫–∏ –±–µ–∑ –∏–Ω—Å–∞–π—Ç–æ–≤
- –ü—Ä–æ–ø—É—Å–∫ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∏–∑-–∑–∞ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π top-N
- –ë–æ–ª–µ–µ {num_plots} –≥—Ä–∞—Ñ–∏–∫–æ–≤
- –û–¥–Ω–æ—Ç–æ–Ω–Ω—ã–µ barplot (–≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã –æ–¥–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞)

# üì• –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
–£ —Ç–µ–±—è –µ—Å—Ç—å:
- DataFrame `df`
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞: {df_structure_info}
- –ú–µ—Ç—Ä–∏–∫–∏: {metrics_results_raw}
- –ê–Ω–∞–ª–∏–∑: {analysis_summary}

# ‚úÖ –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø
- –ò—Å–ø–æ–ª—å–∑—É–π `matplotlib`, `seaborn`
- –°–æ—Ö—Ä–∞–Ω—è–π –≤ `{output_dir}` –∫–∞–∫ `plot_{{—Å—Ç–æ–ª–±—Ü—ã}}_{{—Ç–∏–ø}}.png`
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π `plt.show()`, —Ç–æ–ª—å–∫–æ `plt.savefig()`
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π `try-except`
- –ò—Å–ø–æ–ª—å–∑—É–π `palette='tab10'`, `cmap='viridis'`
- –î–ª—è –æ—Å–∏ X —Å >5 –º–µ—Ç–æ–∫: `rotation=45`, `ha='right'`
- –í—Å–µ–≥–¥–∞ `plt.tight_layout()`
- –°–æ–∑–¥–∞–π –ø–∞–ø–∫—É: `os.makedirs('{output_dir}', exist_ok=True)`
- –ù–µ –∏–∑–º–µ–Ω—è–π `df`, –Ω–µ –∑–∞–≥—Ä—É–∂–∞–π –∑–∞–Ω–æ–≤–æ
- –í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –∫–æ–¥ ({num_plots} –≥—Ä–∞—Ñ–∏–∫–æ–≤!!! —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ –≤—Ä–æ–¥–µ #–ì—Ä–∞—Ñ–∏–∫ 1: ... ). 
"""

