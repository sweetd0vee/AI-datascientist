# Диаграмма архитектуры проекта

## Общая структура

```
┌─────────────────────────────────────────────────────────────┐
│                      Streamlit UI Layer                      │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │ File Upload  │  │ Results View │  │   Settings   │     │
│  └──────────────┘  └──────────────┘  └──────────────┘     │
└───────────────────────────┬─────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                      Core Layer                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │              Orchestrator                             │  │
│  │  ┌──────────────┐  ┌──────────────┐  ┌───────────┐ │  │
│  │  │   Analyzer  │  │   Pipeline   │  │  Factory  │ │  │
│  │  └──────────────┘  └──────────────┘  └───────────┘ │  │
│  └──────────────────────────────────────────────────────┘  │
└───────────┬───────────────────────┬────────────────────────┘
            │                       │
            ▼                       ▼
┌──────────────────────┐  ┌──────────────────────┐
│     LLM Layer        │  │     Data Layer       │
│  ┌────────────────┐  │  │  ┌────────────────┐ │
│  │    Models      │  │  │  │    Loader      │ │
│  │    Prompts     │  │  │  │  Preprocessor  │ │
│  │    Chains      │  │  │  │    Metrics    │ │
│  │    Parsers     │  │  │  │  Visualizer   │ │
│  └────────────────┘  │  │  └────────────────┘ │
└──────────────────────┘  └──────────────────────┘
            │                       │
            └───────────┬───────────┘
                        ▼
            ┌──────────────────────┐
            │    Utils Layer       │
            │  ┌────────────────┐ │
            │  │ Code Executor  │ │
            │  │ Type Converter │ │
            │  │ File Handler   │ │
            │  │    Logger      │ │
            │  └────────────────┘ │
            └──────────────────────┘
                        │
                        ▼
            ┌──────────────────────┐
            │    Config Layer      │
            │  ┌────────────────┐ │
            │  │   Settings     │ │
            │  │ Prompts Config │ │
            │  │ Models Config  │ │
            │  └────────────────┘ │
            └──────────────────────┘
```

## Поток данных (Data Flow)

```
[User] 
  │
  ├─► [UI: File Upload] ──► [Data: Loader] ──► DataFrame
  │                                                    │
  ├─► [UI: Start Analysis] ──► [Core: Orchestrator]   │
  │                              │                    │
  │                              ├─► [LLM: Structure Analysis] ──► Parsed Structure
  │                              │                                              │
  │                              ├─► [Data: Preprocessor] ◄────────────────────┘
  │                              │                    │
  │                              ├─► [LLM: Metrics Plan] ──► Metrics Plan
  │                              │                              │
  │                              ├─► [LLM: Code Generation] ──► Python Code
  │                              │                              │
  │                              ├─► [Utils: Code Executor] ◄──┘
  │                              │                    │
  │                              │                    └─► Metrics Results
  │                              │                              │
  │                              ├─► [LLM: Analysis] ◄──────────┘
  │                              │                    │
  │                              │                    └─► Analysis Summary
  │                              │                              │
  │                              ├─► [LLM: Viz Code] ◄──────────┘
  │                              │                    │
  │                              ├─► [Utils: Code Executor] ──► Plots
  │                              │                    │
  │                              ├─► [LLM: Final Report] ──► Report
  │                              │                    │
  │                              └─► [Utils: File Handler] ──► Saved Files
  │                                                              │
  └─◄ [UI: Results View] ◄──────────────────────────────────────┘
```

## Зависимости модулей

```
┌─────────┐
│   UI    │ ──► зависит от ──► Core, Data
└─────────┘

┌─────────┐
│  Core   │ ──► зависит от ──► LLM, Data, Utils, Config
└─────────┘

┌─────────┐
│   LLM   │ ──► зависит от ──► Config, Utils
└─────────┘

┌─────────┐
│  Data   │ ──► зависит от ──► Utils, Config
└─────────┘

┌─────────┐
│  Utils  │ ──► зависит от ──► Config
└─────────┘

┌─────────┐
│ Config  │ ──► независимый модуль
└─────────┘
```

## Компоненты и их ответственность

### UI Layer
- **File Upload**: Загрузка и валидация файлов
- **Results View**: Отображение результатов анализа
- **Settings**: Настройки интерфейса

### Core Layer
- **Orchestrator**: Координация всех этапов анализа
- **Analyzer**: Основная логика анализа
- **Pipeline**: Конвейер обработки данных
- **Factory**: Создание различных компонентов

### LLM Layer
- **Models**: Инициализация моделей Ollama
- **Prompts**: Шаблоны промптов
- **Chains**: LangChain цепочки
- **Parsers**: Парсинг структурированных ответов

### Data Layer
- **Loader**: Загрузка данных из файлов
- **Preprocessor**: Предобработка данных
- **Metrics**: Расчет метрик
- **Visualizer**: Генерация визуализаций

### Utils Layer
- **Code Executor**: Безопасное выполнение Python кода
- **Type Converter**: Конвертация типов данных
- **File Handler**: Работа с файлами
- **Logger**: Логирование

### Config Layer
- **Settings**: Основные настройки
- **Prompts Config**: Конфигурация промптов
- **Models Config**: Настройки моделей

